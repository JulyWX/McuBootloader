

#include "firmware_rw.h"
#include <string.h>

typedef  void (*IapFun)(void);
IapFun Jump2Application;

/**
  * @brief  ???APP??
  * @param  None
  * @retval None
  * 
  * 
  */
//  APP_BASE_ADDRESS?????Flash???? ??????????????????,
// ((__IO uint32_t)ApplicationAddress)?????????????????,
// ??????RAM,?RAM??????0x20000000,??(…… & 0x2FFE0000 ) )??????????????????0x20000000~0x2001ffff???
// CORTEX-M3??????BOOT????????PC?????:BOOT???FLASH??,???CPU???????:???????,?????????
void JumpToApp(void)
{  
    if(((*(vu32*)APP_START_ADDRESS)&0x2FFE0000) == 0x20000000)       //??????????.
    {
        Jump2Application  = (IapFun)*(vu32*)(APP_START_ADDRESS+4);   //????????????(???????????,??????4????????)?
        /* Initialize user application's Stack Pointer */
        __set_MSP(*(vu32*) APP_START_ADDRESS);                       //????????????????
        Jump2Application();                                         //??PC???????
    }
}


/**
* @brief  App ??????
* @param  None
* @retval None
*/
void AppInit(void)
{
    SCB->VTOR = APP_START_ADDRESS;     //SCB->VTOR?Cortex????????????,???????????????,?Cortex-M3?,???????0x8000000?
}

